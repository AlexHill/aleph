<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>aleph.http documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Aleph 0.4.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>aleph</span></div></div></li><li class="depth-2 branch"><a href="aleph.flow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>flow</span></div></a></li><li class="depth-2 branch current"><a href="aleph.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-2 branch"><a href="aleph.tcp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcp</span></div></a></li><li class="depth-2"><a href="aleph.udp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>udp</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="aleph.http.html#var-connect"><div class="inner"><span>connect</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-connection-pool"><div class="inner"><span>connection-pool</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-default-connection-pool"><div class="inner"><span>default-connection-pool</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-default-response-executor"><div class="inner"><span>default-response-executor</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-delete"><div class="inner"><span>delete</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-get"><div class="inner"><span>get</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-head"><div class="inner"><span>head</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-options"><div class="inner"><span>options</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-post"><div class="inner"><span>post</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-put"><div class="inner"><span>put</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-register-connection-stats-callback"><div class="inner"><span>register-connection-stats-callback</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-request"><div class="inner"><span>request</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-start-server"><div class="inner"><span>start-server</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-trace"><div class="inner"><span>trace</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-unregister-connection-stats-callback"><div class="inner"><span>unregister-connection-stats-callback</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-websocket-client"><div class="inner"><span>websocket-client</span></div></a></li><li class="depth-1"><a href="aleph.http.html#var-websocket-connection"><div class="inner"><span>websocket-connection</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">aleph.http</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-connect"><h3>connect</h3><div class="usage"><code>(connect url)</code><code>(connect url {:keys [pool middleware headers body], :or {pool default-connection-pool, middleware identity}, :as options})</code></div><div class="doc"><div class="markdown"><p>Makes a CONNECT request, returns a deferred representing the response.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>pool</code> </td>
      <td align="left">the <code>connection-pool</code> that should be used, defaults to the <code>default-connection-pool</code></td>
    </tr>
    <tr>
      <td align="left"><code>middleware</code> </td>
      <td align="left">any additional middleware that should be used for handling requests and responses</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the HTTP headers for the request</td>
    </tr>
    <tr>
      <td align="left"><code>body</code> </td>
      <td align="left">an optional body, which should be coercable to a byte representation via <a href="https://github.com/ztellman/byte-streams">byte-streams</a></td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L238">view source</a></div></div><div class="public anchor" id="var-connection-pool"><h3>connection-pool</h3><div class="usage"><code>(connection-pool {:keys [connections-per-host total-connections target-utilization connection-options stats-callback response-executor], :or {connections-per-host 8, total-connections 1024, target-utilization 0.9, response-executor default-response-executor}})</code></div><div class="doc"><div class="markdown"><p>Returns a connection pool which can be used as an argument in <code>request</code>.</p><p>|:&mdash;|:&mdash;  | <code>connections-per-host</code> | the maximum number of simultaneous connections to any host  | <code>total-connections</code> | the maximum number of connections across all hosts  | <code>target-utilization</code> | the target utilization of connections per host, within <code>[0,1]</code>, defaults to <code>0.9</code>  | <code>stats-callback</code> | an optional callback which is invoked with a map of hosts onto usage statistics every ten seconds</p><p>the <code>connection-options</code> are a map describing behavior across all connections:</p><p>|:&mdash;|:&mdash;  | <code>local-address</code> | an optional <code>java.net.SocketAddress</code> describing which local interface should be used  | <code>bootstrap-transform</code> | a function that takes an <code>io.netty.bootstrap.ServerBootstrap</code> object, which represents the server, and modifies it.  | <code>pipeline-transform</code> | a function that takes an <code>io.netty.channel.ChannelPipeline</code> object, which represents a connection, and modifies it.  | <code>insecure?</code> | if <code>true</code>, ignores the certificate for any <code>https://</code> domains  | <code>response-buffer-size</code> | the amount of the response, in bytes, that is buffered before the request returns, defaults to <code>65536</code>. This does <em>not</em> represent the maximum size response that the client can handle (which is unbounded), and is only a means of maximizing performance.  | <code>keep-alive?</code> | if <code>true</code>, attempts to reuse connections for multiple requests, defaults to <code>true</code>.  | <code>raw-stream?</code> | if <code>true</code>, bodies of respnoses will not be buffered at all, and represented as Manifold streams of <code>io.netty.buffer.ByteBuf</code> objects rather than as an <code>InputStream</code>. This will minimize copying, but means that care must be taken with Netty&rsquo;s buffer reference counting. Only recommended for advanced users. | <code>max-header-size</code> | the maximum characters that can be in a single header entry of a response, defaults to <code>8192</code> | <code>max-chunk-size</code> | the maximum characters that can be in a single chunk of a streamed response, defaults to <code>8192</code></p></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L77">view source</a></div></div><div class="public anchor" id="var-default-connection-pool"><h3>default-connection-pool</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L132">view source</a></div></div><div class="public anchor" id="var-default-response-executor"><h3>default-response-executor</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L74">view source</a></div></div><div class="public anchor" id="var-delete"><h3>delete</h3><div class="usage"><code>(delete url)</code><code>(delete url {:keys [pool middleware headers body], :or {pool default-connection-pool, middleware identity}, :as options})</code></div><div class="doc"><div class="markdown"><p>Makes a DELETE request, returns a deferred representing the response.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>pool</code> </td>
      <td align="left">the <code>connection-pool</code> that should be used, defaults to the <code>default-connection-pool</code></td>
    </tr>
    <tr>
      <td align="left"><code>middleware</code> </td>
      <td align="left">any additional middleware that should be used for handling requests and responses</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the HTTP headers for the request</td>
    </tr>
    <tr>
      <td align="left"><code>body</code> </td>
      <td align="left">an optional body, which should be coercable to a byte representation via <a href="https://github.com/ztellman/byte-streams">byte-streams</a></td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L237">view source</a></div></div><div class="public anchor" id="var-get"><h3>get</h3><div class="usage"><code>(get url)</code><code>(get url {:keys [pool middleware headers body], :or {pool default-connection-pool, middleware identity}, :as options})</code></div><div class="doc"><div class="markdown"><p>Makes a GET request, returns a deferred representing the response.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>pool</code> </td>
      <td align="left">the <code>connection-pool</code> that should be used, defaults to the <code>default-connection-pool</code></td>
    </tr>
    <tr>
      <td align="left"><code>middleware</code> </td>
      <td align="left">any additional middleware that should be used for handling requests and responses</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the HTTP headers for the request</td>
    </tr>
    <tr>
      <td align="left"><code>body</code> </td>
      <td align="left">an optional body, which should be coercable to a byte representation via <a href="https://github.com/ztellman/byte-streams">byte-streams</a></td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L231">view source</a></div></div><div class="public anchor" id="var-head"><h3>head</h3><div class="usage"><code>(head url)</code><code>(head url {:keys [pool middleware headers body], :or {pool default-connection-pool, middleware identity}, :as options})</code></div><div class="doc"><div class="markdown"><p>Makes a HEAD request, returns a deferred representing the response.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>pool</code> </td>
      <td align="left">the <code>connection-pool</code> that should be used, defaults to the <code>default-connection-pool</code></td>
    </tr>
    <tr>
      <td align="left"><code>middleware</code> </td>
      <td align="left">any additional middleware that should be used for handling requests and responses</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the HTTP headers for the request</td>
    </tr>
    <tr>
      <td align="left"><code>body</code> </td>
      <td align="left">an optional body, which should be coercable to a byte representation via <a href="https://github.com/ztellman/byte-streams">byte-streams</a></td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L236">view source</a></div></div><div class="public anchor" id="var-options"><h3>options</h3><div class="usage"><code>(options url)</code><code>(options url {:keys [pool middleware headers body], :or {pool default-connection-pool, middleware identity}, :as options})</code></div><div class="doc"><div class="markdown"><p>Makes a OPTIONS request, returns a deferred representing the response.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>pool</code> </td>
      <td align="left">the <code>connection-pool</code> that should be used, defaults to the <code>default-connection-pool</code></td>
    </tr>
    <tr>
      <td align="left"><code>middleware</code> </td>
      <td align="left">any additional middleware that should be used for handling requests and responses</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the HTTP headers for the request</td>
    </tr>
    <tr>
      <td align="left"><code>body</code> </td>
      <td align="left">an optional body, which should be coercable to a byte representation via <a href="https://github.com/ztellman/byte-streams">byte-streams</a></td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L234">view source</a></div></div><div class="public anchor" id="var-post"><h3>post</h3><div class="usage"><code>(post url)</code><code>(post url {:keys [pool middleware headers body], :or {pool default-connection-pool, middleware identity}, :as options})</code></div><div class="doc"><div class="markdown"><p>Makes a POST request, returns a deferred representing the response.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>pool</code> </td>
      <td align="left">the <code>connection-pool</code> that should be used, defaults to the <code>default-connection-pool</code></td>
    </tr>
    <tr>
      <td align="left"><code>middleware</code> </td>
      <td align="left">any additional middleware that should be used for handling requests and responses</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the HTTP headers for the request</td>
    </tr>
    <tr>
      <td align="left"><code>body</code> </td>
      <td align="left">an optional body, which should be coercable to a byte representation via <a href="https://github.com/ztellman/byte-streams">byte-streams</a></td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L232">view source</a></div></div><div class="public anchor" id="var-put"><h3>put</h3><div class="usage"><code>(put url)</code><code>(put url {:keys [pool middleware headers body], :or {pool default-connection-pool, middleware identity}, :as options})</code></div><div class="doc"><div class="markdown"><p>Makes a PUT request, returns a deferred representing the response.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>pool</code> </td>
      <td align="left">the <code>connection-pool</code> that should be used, defaults to the <code>default-connection-pool</code></td>
    </tr>
    <tr>
      <td align="left"><code>middleware</code> </td>
      <td align="left">any additional middleware that should be used for handling requests and responses</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the HTTP headers for the request</td>
    </tr>
    <tr>
      <td align="left"><code>body</code> </td>
      <td align="left">an optional body, which should be coercable to a byte representation via <a href="https://github.com/ztellman/byte-streams">byte-streams</a></td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L233">view source</a></div></div><div class="public anchor" id="var-register-connection-stats-callback"><h3>register-connection-stats-callback</h3><div class="usage"><code>(register-connection-stats-callback c)</code></div><div class="doc"><div class="markdown"><p>Registers a callback which will be called with connection-pool stats.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L64">view source</a></div></div><div class="public anchor" id="var-request"><h3>request</h3><div class="usage"><code>(request {:keys [pool middleware], :or {pool default-connection-pool, middleware identity}, :as req})</code></div><div class="doc"><div class="markdown"><p>Takes an HTTP request, as defined by the Ring protocol, with the extensions defined by <a href="https://github.com/dakrone/clj-http">clj-http</a>, and returns a deferred representing the HTTP response. Also allows for a custom <code>pool</code> or <code>middleware</code> to be defined.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L165">view source</a></div></div><div class="public anchor" id="var-start-server"><h3>start-server</h3><div class="usage"><code>(start-server handler {:keys [port socket-address executor raw-stream? bootstrap-transform pipeline-transform ssl-context request-buffer-size shutdown-executor? rejected-handler], :as options})</code></div><div class="doc"><div class="markdown"><p>Starts an HTTP server using the provided Ring <code>handler</code>. Returns a server object which can be stopped  via <code>java.io.Closeable.close()</code>, and whose port can be discovered with <code>aleph.netty/port</code>.</p><p>|:&mdash;&mdash;&mdash;|:&mdash;&mdash;&mdash;&mdash;-  | <code>port</code> | the port the server will bind to. If <code>-1</code>, the server will bind to a random port.  | <code>socket-address</code> | a <code>java.net.SocketAddress</code> specifying both the port and interface to bind to.  | <code>ssl-context</code> | an <code>io.netty.handler.ssl.SslContext</code> object. If a self-signed certificate is all that&rsquo;s required, <code>(aleph.netty/self-signed-ssl-context)</code> will suffice.  | <code>bootstrap-transform</code> | a function that takes an <code>io.netty.bootstrap.ServerBootstrap</code> object, which represents the server, and modifies it.  | <code>pipeline-transform</code> | a function that takes an <code>io.netty.channel.ChannelPipeline</code> object, which represents a connection, and modifies it.  | <code>executor</code> | a <code>java.util.concurrent.Executor</code> which is used to handle individual requests. To avoid this indirection you may specify <code>:none</code>, but in this case extreme care must be taken to avoid blocking operations on the handler&rsquo;s thread.  | <code>shutdown-executor?</code> | if <code>true</code>, the executor will be shut down when <code>.close()</code> is called on the server, defaults to <code>true</code>.  | <code>request-buffer-size</code> | the maximum body size, in bytes, which the server will allow to accumulate before invoking the handler, defaults to <code>16384</code>. This does <em>not</em> represent the maximum size request the server can handle (which is unbounded), and is only a means of maximizing performance.  | <code>raw-stream?</code> | if <code>true</code>, bodies of requests will not be buffered at all, and will be represented as Manifold streams of <code>io.netty.buffer.ByteBuf</code> objects rather than as an <code>InputStream</code>. This will minimize copying, but means that care must be taken with Netty&rsquo;s buffer reference counting. Only recommended for advanced users.  | <code>rejected-handler</code> | a spillover request-handler which is invoked when the executor&rsquo;s queue is full, and the request cannot be processed. Defaults to a <code>503</code> response. | <code>max-initial-line-length</code> | the maximum characters that can be in the initial line of the request, defaults to <code>4096</code> | <code>max-header-size</code> | the maximum characters that can be in a single header entry of a request, defaults to <code>8192</code> | <code>max-chunk-size</code> | the maximum characters that can be in a single chunk of a streamed request, defaults to <code>8192</code></p></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L17">view source</a></div></div><div class="public anchor" id="var-trace"><h3>trace</h3><div class="usage"><code>(trace url)</code><code>(trace url {:keys [pool middleware headers body], :or {pool default-connection-pool, middleware identity}, :as options})</code></div><div class="doc"><div class="markdown"><p>Makes a TRACE request, returns a deferred representing the response.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>pool</code> </td>
      <td align="left">the <code>connection-pool</code> that should be used, defaults to the <code>default-connection-pool</code></td>
    </tr>
    <tr>
      <td align="left"><code>middleware</code> </td>
      <td align="left">any additional middleware that should be used for handling requests and responses</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the HTTP headers for the request</td>
    </tr>
    <tr>
      <td align="left"><code>body</code> </td>
      <td align="left">an optional body, which should be coercable to a byte representation via <a href="https://github.com/ztellman/byte-streams">byte-streams</a></td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L235">view source</a></div></div><div class="public anchor" id="var-unregister-connection-stats-callback"><h3>unregister-connection-stats-callback</h3><div class="usage"><code>(unregister-connection-stats-callback c)</code></div><div class="doc"><div class="markdown"><p>Unregisters a previous connection-pool stats callback.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L69">view source</a></div></div><div class="public anchor" id="var-websocket-client"><h3>websocket-client</h3><div class="usage"><code>(websocket-client url)</code><code>(websocket-client url {:keys [raw-stream? insecure? headers], :as options})</code></div><div class="doc"><div class="markdown"><p>Given a url, returns a deferred which yields a duplex stream that can be used to communicate with a server over the WebSocket protocol.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>raw-stream?</code> </td>
      <td align="left">if <code>true</code>, the connection will emit raw <code>io.netty.buffer.ByteBuf</code> objects rather than strings or byte-arrays. This will minimize copying, but means that care must be taken with Netty&rsquo;s buffer reference counting. Only recommended for advanced users.</td>
    </tr>
    <tr>
      <td align="left"><code>insecure?</code> </td>
      <td align="left">if <code>true</code>, the certificates for <code>wss://</code> will be ignored.</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the headers that should be included in the handshake</td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L139">view source</a></div></div><div class="public anchor" id="var-websocket-connection"><h3>websocket-connection</h3><div class="usage"><code>(websocket-connection req)</code><code>(websocket-connection req {:keys [raw-stream? headers], :as options})</code></div><div class="doc"><div class="markdown"><p>Given an HTTP request that can be upgraded to a WebSocket connection, returns a deferred which yields a duplex stream that can be used to communicate with the client over the WebSocket protocol.</p>
<table>
  <tbody>
    <tr>
      <td align="left"><code>raw-stream?</code> </td>
      <td align="left">if <code>true</code>, the connection will emit raw <code>io.netty.buffer.ByteBuf</code> objects rather than strings or byte-arrays. This will minimize copying, but means that care must be taken with Netty&rsquo;s buffer reference counting. Only recommended for advanced users.</td>
    </tr>
    <tr>
      <td align="left"><code>headers</code> </td>
      <td align="left">the headers that should be included in the handshake</td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/ztellman/aleph/tree/0.4.0/src/aleph/http.clj#L152">view source</a></div></div></div></body></html>